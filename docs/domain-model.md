# B0 ë„ë©”ì¸ ëª¨ë¸

## ë„ë©”ì¸ ê°œìš”

B0ëŠ” "ì§€í•˜ 0ì¸µì—ì„œ ì¶œë°œí•˜ëŠ” ë¹„í–‰ì„ ì„ íƒ€ê³  ê°€ìƒ ì„¸ê³„ë¥¼ ì—¬í–‰í•˜ë©° íë§ê³¼ ìê¸°ì„±ì°°ì„ ê²½í—˜í•˜ëŠ” ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°"ì…ë‹ˆë‹¤.

ì‚¬ìš©ìëŠ” B0 ë¹„í–‰ì„  í„°ë¯¸ë„ì—ì„œ 6ê°œì˜ í…Œë§ˆë³„ ë„ì‹œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ ë¹„í–‰ì„ ì„ íƒ€ê³  ì´ë™í•˜ê³ , ë„ì°© í›„ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ì— ì²´í¬ì¸í•˜ì—¬ ë‹¤ë¥¸ ì—¬í–‰ìë“¤ê³¼ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê±°ë‚˜ ì¼ê¸°ë¥¼ ì“°ë©° ìê¸°ì„±ì°°ì˜ ì‹œê°„ì„ ê°€ì§‘ë‹ˆë‹¤.

---

## ìœ ë¹„ì¿¼í„°ìŠ¤ ì–¸ì–´ (Ubiquitous Language)

ë„ë©”ì¸ ì „ë¬¸ê°€ì™€ ê°œë°œì ê°„ì˜ ê³µí†µ ì–¸ì–´:

### í•µì‹¬ ìš©ì–´

- **B0 (ì§€í•˜ 0ì¸µ)**: ë¹„í–‰ì„  í„°ë¯¸ë„ì´ ìˆëŠ” ê°€ìƒì˜ ì‹œì‘ ê³µê°„
- **ì—¬í–‰ì (Traveler)**: ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ìš©ì
- **ë„ì‹œ (City)**: 6ê°œì˜ í…Œë§ˆë³„ ëª©ì ì§€ (ì„¸ë Œì‹œì•„, ë¡œë Œì‹œì•„, ì—í…Œë¦¬ì•„, ë“œë¦¬ëª¨ìŠ¤, ì…€ë ˆë‹ˆì•„, ì•„ë²¤íˆ¬ë¼)
- **ë¹„í–‰ì„  (Airship)**: ë„ì‹œë¡œ ì´ë™í•˜ëŠ” êµí†µ ìˆ˜ë‹¨ì˜ íƒ€ì…. cost_factor(ê°€ê²© ë°°ìˆ˜)ì™€ duration_factor(ì‹œê°„ ë°°ìˆ˜)ë¡œ ë¹„ìš©ê³¼ ì‹œê°„ì„ ì¡°ì ˆ (ì˜ˆ: ì¼ë°˜ ë¹„í–‰ì„ , ê³ ì† ë¹„í–‰ì„ )
- **í‹°ì¼“ (Ticket)**: ë¹„í–‰ì„  íƒ‘ìŠ¹ê¶Œ
- **ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ (Guesthouse)**: ë„ì‹œì— ìˆëŠ” ìˆ™ì†Œ
- **ë£¸ (Room)**: ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë‚´ ìµœëŒ€ 6ëª…ì´ ë¨¸ë¬´ë¥´ë©° ëŒ€í™”í•˜ëŠ” ê³µê°„
- **ì²´ë¥˜ (Stay)**: ë£¸ì—ì„œ ë¨¸ë¬´ëŠ” ê²ƒ (ê¸°ë³¸ 24ì‹œê°„)
- **ì²´í¬ì¸ (Check-in)**: ë£¸ ì…ì‹¤
- **ì²´í¬ì•„ì›ƒ (Check-out)**: ë£¸ í‡´ì‹¤ (ìë™ ë˜ëŠ” ìˆ˜ë™)
- **ì—°ì¥ (Extension)**: ì²´í¬ì•„ì›ƒ ì‹œê°„ì„ 24ì‹œê°„ ì—°ì¥
- **ë‹¨ì²´ ëŒ€í™” (Group Chat)**: ë£¸ ë‚´ ëª¨ë“  ì—¬í–‰ìê°€ ì°¸ì—¬í•˜ëŠ” ëŒ€í™”
- **1:1 ëŒ€í™” (Direct Message)**: ë£¸ ë‚´ íŠ¹ì • ë‘ ì—¬í–‰ì ê°„ì˜ ëŒ€í™”
- **ëŒ€í™” ì¹´ë“œ (Conversation Card)**: ëŒ€í™” ì£¼ì œë¥¼ ì œê³µí•˜ëŠ” ì§ˆë¬¸ ì¹´ë“œ
- **ì¼ê¸° (Diary)**: í•˜ë£¨ì˜ ê¸°ë¡ (500ì, í•˜ë£¨ 1íšŒ 50P)
- **ë¬¸ë‹µì§€ (Questionnaire)**: ë„ì‹œë³„ 3ê°œ ì§ˆë¬¸ì— ë‹µë³€ (ë„ì‹œë³„ 1íšŒ 50P)
- **í¬ì¸íŠ¸ (Points)**: ì„œë¹„ìŠ¤ ë‚´ í™”í (í‹°ì¼“ êµ¬ë§¤, ì—°ì¥ ë“±ì— ì‚¬ìš©)

### ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

- **GuesthouseëŠ” ì˜êµ¬ì **: ë„ì‹œì˜ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ëŠ” í•­ìƒ ì¡´ì¬
- **Roomì€ ë™ì  ìƒì„±/ì‚­ì œ**:
  - ì²« ë²ˆì§¸ ì—¬í–‰ì ì²´í¬ì¸ ì‹œ ìƒˆ ë£¸ ìƒì„±
  - ëª¨ë“  ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ ë£¸ ì‚­ì œ
  - ìµœëŒ€ 6ëª…ê¹Œì§€ ê°™ì€ ë£¸ì— ë°°ì •
- **ê°œë³„ ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ**:
  - ê° ì—¬í–‰ìì˜ ì²´í¬ì¸ ì‹œê°„ì´ ë‹¤ë¦„
  - ê°ì ì²´í¬ì¸ ì‹œê°„ + 24ì‹œê°„ = ê°œë³„ ì²´í¬ì•„ì›ƒ ì‹œê°„
  - ì—°ì¥ë„ ê°œì¸ë³„ (300P/24ì‹œê°„)
- **ìë™ ë£¸ ë°°ì •**: ë„ì°© ì‹œ 6ëª… ë¯¸ë§Œì¸ í™œì„± ë£¸ì— ë°°ì •, ì—†ìœ¼ë©´ ìƒˆ ë£¸ ìƒì„±
- **ë©”ì‹œì§€ 3ì¼ ë³´ê´€**: ì±„íŒ… ë©”ì‹œì§€ëŠ” 3ì¼ í›„ ìë™ ì‚­ì œ
- **í¬ì¸íŠ¸ íšë“ ì œí•œ**: ì¼ê¸°ëŠ” í•˜ë£¨ 1íšŒ, ë¬¸ë‹µì§€ëŠ” ë„ì‹œë³„ 1íšŒë§Œ í¬ì¸íŠ¸ íšë“
- **ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ**: ì±„íŒ… ë©”ì‹œì§€ 300ì, ì¼ê¸° 500ì, ë¬¸ë‹µì§€ ë‹µë³€ 200ì
- **ë©”ì‹œì§€ ì „ì†¡ ì œí•œ (ìŠ¤íŒ¸ ë°©ì§€)**: 2ì´ˆì— 1íšŒ ì „ì†¡ ì œí•œ (Redis Rate Limiting)
- **ëŒ€í™” ì¹´ë“œ ì‚¬ìš©**: ë¬´ì œí•œ ì‚¬ìš© ê°€ëŠ¥ (ë™ì¼ ì¹´ë“œ ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)

---

## ë°”ìš´ë””ë“œ ì»¨í…ìŠ¤íŠ¸ (Bounded Contexts)

```mermaid
graph TB
    subgraph UserContext[ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸]
        User[User<br/>ì—¬í–‰ì]
        Profile[Profile<br/>í”„ë¡œí•„]
    end

    subgraph TravelContext[ì—¬í–‰ ì»¨í…ìŠ¤íŠ¸]
        City[City<br/>ë„ì‹œ]
        Ticket[Ticket<br/>í‹°ì¼“]
        Airship[Airship Logic<br/>ë¹„í–‰ì„  ë¡œì§]
    end

    subgraph RoomContext[ë£¸ ì»¨í…ìŠ¤íŠ¸]
        Guesthouse[Guesthouse<br/>ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤]
        Room[Room<br/>ë£¸<br/>ì²´ë¥˜+ëŒ€í™” ê³µê°„]
        RoomStay[RoomStay<br/>ì²´ë¥˜]
        RoomAssignment[Room Assignment<br/>ìë™ ë£¸ ë°°ì •]
        Checkout[Checkout Logic<br/>ì²´í¬ì•„ì›ƒ ë¡œì§]
    end

    subgraph ChatContext[ë‹¨ì²´ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸]
        ChatMessage[ChatMessage<br/>ë£¸ ë‚´ ë‹¨ì²´ ë©”ì‹œì§€]
        ConversationCard[ConversationCard<br/>ëŒ€í™” ì¹´ë“œ]
    end

    subgraph DMContext[1:1 ëŒ€í™” ì»¨í…ìŠ¤íŠ¸]
        DMRoom[DirectMessageRoom<br/>1:1 ëŒ€í™”ë°©]
        DirectMessage[DirectMessage<br/>1:1 ë©”ì‹œì§€]
    end

    subgraph ReflectionContext[ìê¸°ì„±ì°° ì»¨í…ìŠ¤íŠ¸]
        Diary[Diary<br/>ì¼ê¸°]
        Questionnaire[Questionnaire<br/>ë¬¸ë‹µì§€]
    end

    subgraph PointContext[í¬ì¸íŠ¸ ì»¨í…ìŠ¤íŠ¸]
        PointTransaction[PointTransaction<br/>í¬ì¸íŠ¸ ê±°ë˜]
        PointBalance[Point Balance<br/>í¬ì¸íŠ¸ ì”ì•¡]
    end

    UserContext -->|êµ¬ë§¤| TravelContext
    TravelContext -->|ë„ì°©/ì²´í¬ì¸| RoomContext
    RoomContext -->|ë‹¨ì²´ ëŒ€í™”| ChatContext
    RoomContext -->|1:1 ëŒ€í™”| DMContext
    UserContext -->|ì‘ì„±| ReflectionContext
    UserContext -->|ê±°ë˜| PointContext
    TravelContext -->|í‹°ì¼“ êµ¬ë§¤<br/>í¬ì¸íŠ¸ ì°¨ê°| PointContext
    RoomContext -->|ì—°ì¥<br/>í¬ì¸íŠ¸ ì°¨ê°| PointContext
    ReflectionContext -->|ì¼ê¸°/ë¬¸ë‹µì§€<br/>í¬ì¸íŠ¸ íšë“| PointContext

    style UserContext fill:#e1f5ff
    style TravelContext fill:#fff4e1
    style RoomContext fill:#ffe1e1
    style ChatContext fill:#e1ffe1
    style DMContext fill:#d4f1e1
    style ReflectionContext fill:#f4e1ff
    style PointContext fill:#ffe1f4
```

### 1. ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ (User Context)

**ì±…ì„**: ì‚¬ìš©ì ì¸ì¦, í”„ë¡œí•„ ê´€ë¦¬

**í•µì‹¬ ê°œë…**:
- User (ì—¬í–‰ì)
- Profile (ë‹‰ë„¤ì„, ì´ëª¨ì§€)
- Authentication (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¸ì¦)

### 2. ì—¬í–‰ ì»¨í…ìŠ¤íŠ¸ (Travel Context)

**ì±…ì„**: ë„ì‹œ íƒìƒ‰, ë¹„í–‰ì„  í‹°ì¼“ êµ¬ë§¤ ë° ì´ë™

**í•µì‹¬ ê°œë…**:
- City (ë„ì‹œ)
- Ticket (í‹°ì¼“)
- Airship (ë¹„í–‰ì„  íƒ€ì…: ì¼ë°˜/ì¾Œì†)
- Travel Duration (ì´ë™ ì‹œê°„)

### 3. ë£¸ ì»¨í…ìŠ¤íŠ¸ (Room Context)

**ì±…ì„**: ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë£¸ ë°°ì •, ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ê´€ë¦¬, ì—¬í–‰ì ì²´ë¥˜

**í•µì‹¬ ê°œë…**:
- Guesthouse (ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤)
- Room (ì—¬í–‰ìë“¤ì´ ì²´ë¥˜í•˜ê³  ëŒ€í™”í•˜ëŠ” ê³µê°„)
- RoomStay (ì²´ë¥˜ ê¸°ë¡)
- Check-in/Check-out
- Extension (ì—°ì¥)
- Auto Room Assignment (ìë™ ë£¸ ë°°ì •)

### 4. ë‹¨ì²´ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ (Chat Context)

**ì±…ì„**: ë£¸ ë‚´ ëª¨ë“  ì—¬í–‰ìê°€ ì°¸ì—¬í•˜ëŠ” ë‹¨ì²´ ëŒ€í™”

**í•µì‹¬ ê°œë…**:
- ChatMessage (ë£¸ ë‚´ ë‹¨ì²´ ë©”ì‹œì§€)
- ConversationCard (ëŒ€í™” ì¹´ë“œ)
- Message Expiration (ë©”ì‹œì§€ ë§Œë£Œ)

### 5. 1:1 ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ (DirectMessage Context)

**ì±…ì„**: ë£¸ ë‚´ íŠ¹ì • ë‘ ì—¬í–‰ì ê°„ 1:1 ëŒ€í™”

**í•µì‹¬ ê°œë…**:
- DirectMessageRoom (1:1 ëŒ€í™”ë°©)
- DirectMessage (1:1 ë©”ì‹œì§€)
- Conversation Request (ëŒ€í™” ì‹ ì²­/ìˆ˜ë½/ê±°ì ˆ)

### 6. ìê¸°ì„±ì°° ì»¨í…ìŠ¤íŠ¸ (Self-Reflection Context)

**ì±…ì„**: ì¼ê¸°, ë¬¸ë‹µì§€ ì‘ì„± ë° ê´€ë¦¬

**í•µì‹¬ ê°œë…**:
- Diary (ì¼ê¸°)
- Questionnaire (ë¬¸ë‹µì§€)
- City Questions (ë„ì‹œë³„ ì§ˆë¬¸)

### 7. í¬ì¸íŠ¸ ì»¨í…ìŠ¤íŠ¸ (Point Context)

**ì±…ì„**: í¬ì¸íŠ¸ íšë“, ì‚¬ìš©, ì”ì•¡ ê´€ë¦¬

**í•µì‹¬ ê°œë…**:
- PointTransaction (í¬ì¸íŠ¸ ê±°ë˜)
- Point Balance (í¬ì¸íŠ¸ ì”ì•¡)
- Earn/Spend Rules (íšë“/ì‚¬ìš© ê·œì¹™)

---

## ì• ê·¸ë¦¬ê²Œì´íŠ¸ (Aggregates)

### 1. User Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: User

**ì—”í‹°í‹°**:
- User (ì—¬í–‰ì)

**ê°’ ê°ì²´**:
- Email
- Password
- Nickname
- ProfileEmoji
- PointBalance

**ë¶ˆë³€ì‹**:
- ì´ë©”ì¼ì€ ìœ ì¼í•´ì•¼ í•¨
- ë‹‰ë„¤ì„ì€ ìœ ì¼í•´ì•¼ í•¨ (2-10ì)
- í¬ì¸íŠ¸ëŠ” ìŒìˆ˜ê°€ ë  ìˆ˜ ì—†ìŒ

### 2. Travel Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: Ticket

**ì—”í‹°í‹°**:
- Ticket (í‹°ì¼“)
- City (ë„ì‹œ) - ê¸°ì¤€ ê°€ê²©ê³¼ ê¸°ì¤€ ë¹„í–‰ ì‹œê°„ì„ ê°€ì§
- Airship (ë¹„í–‰ì„ ) - ê°€ê²© ë°°ìˆ˜ì™€ ì‹œê°„ ë°°ìˆ˜ë¥¼ ê°€ì§

**ê°’ ê°ì²´**:
- TicketStatus (PURCHASED, BOARDING, COMPLETED, CANCELED)

**ë¹„ìš©/ì‹œê°„ ê³„ì‚°**:
- í‹°ì¼“ ë¹„ìš© = City.base_cost_points Ã— Airship.cost_factor
- ì´ë™ ì‹œê°„ = City.base_duration_hours Ã— Airship.duration_factor
- ì˜ˆ: ì„¸ë Œì‹œì•„(100P, 1h) + ì¼ë°˜ ë¹„í–‰ì„ (Ã—1, Ã—3) = 100P, 3ì‹œê°„
- ì˜ˆ: ì„¸ë Œì‹œì•„(100P, 1h) + ê³ ì† ë¹„í–‰ì„ (Ã—2, Ã—1) = 200P, 1ì‹œê°„

**ë¶ˆë³€ì‹**:
- í‹°ì¼“ì€ í™œì„±í™”ëœ ë„ì‹œë¡œë§Œ ë°œê¶Œ ê°€ëŠ¥
- í‹°ì¼“ì€ í™œì„±í™”ëœ ë¹„í–‰ì„ ìœ¼ë¡œë§Œ ë°œê¶Œ ê°€ëŠ¥
- í‹°ì¼“ ë¹„ìš©ì€ ë„ì‹œ ê¸°ì¤€ ê°€ê²© Ã— ë¹„í–‰ì„  ê°€ê²© ë°°ìˆ˜ë¡œ ê³„ì‚°
- ì´ë™ ì‹œê°„ì€ ë„ì‹œ ê¸°ì¤€ ì‹œê°„ Ã— ë¹„í–‰ì„  ì‹œê°„ ë°°ìˆ˜ë¡œ ê³„ì‚°

### 3. Room Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: Room

**ì—”í‹°í‹°**:
- Room (ë£¸ - ë™ì ìœ¼ë¡œ ìƒì„±/ì‚­ì œë˜ëŠ” ì²´ë¥˜ ë° ëŒ€í™” ê³µê°„)
- RoomStay (ê°œë³„ ì—¬í–‰ìì˜ ì²´ë¥˜ ê¸°ë¡)
- Guesthouse (ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ - ì˜êµ¬ì  ì»¨í…Œì´ë„ˆ)

**ê°’ ê°ì²´**:
- RoomCapacity (ìµœëŒ€ 6ëª…)
- CheckInTime (ê°œë³„)
- CheckOutTime (ê°œë³„)
- ExtensionCount (ê°œë³„)
- RoomStatus (ACTIVE, FULL)

**ë¶ˆë³€ì‹**:
- ë£¸ ì •ì›ì€ ìµœëŒ€ 6ëª…
- ê° ì—¬í–‰ìì˜ ì²´í¬ì¸ ì‹œê°„ì€ ë…ë¦½ì 
- ê° ì—¬í–‰ìëŠ” ì²´í¬ì¸ ì‹œê°„ + 24ì‹œê°„ í›„ ìë™ ì²´í¬ì•„ì›ƒ
- ëª¨ë“  ì—¬í–‰ìê°€ ì²´í¬ì•„ì›ƒí•˜ë©´ ë£¸ soft delete (deleted_at ì„¤ì •)

**ë„ë©”ì¸ ë¡œì§**:
- **ë£¸ ìƒì„±**: ì²« ë²ˆì§¸ ì—¬í–‰ì ì²´í¬ì¸ ì‹œ ìƒˆ ë£¸ ìƒì„±
- **ìë™ ë£¸ ë°°ì •**: 6ëª… ë¯¸ë§Œì¸ í™œì„± ë£¸ì— ë°°ì •, ì—†ìœ¼ë©´ ìƒˆ ë£¸ ìƒì„±
- **ê°œë³„ ì²´í¬ì¸**: ê° ì—¬í–‰ìë§ˆë‹¤ ê³ ìœ í•œ ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ì‹œê°„
- **ê°œë³„ ì—°ì¥**: ê° ì—¬í–‰ìê°€ ë…ë¦½ì ìœ¼ë¡œ 300Pë¡œ 24ì‹œê°„ ì—°ì¥
- **ë£¸ ì‚­ì œ**: ë§ˆì§€ë§‰ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ `deleted_at` ì„¤ì • (soft delete), ë°°ì¹˜ë¡œ ì‹¤ì œ ì‚­ì œ
- **ë£¸ ëŒ€í™”**: í˜„ì¬ ì²´ë¥˜ ì¤‘ì¸ ì—¬í–‰ìë“¤ ê°„ ëŒ€í™”

### 4. Chat Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: ChatMessage

**ì—”í‹°í‹°**:
- ChatMessage (ë£¸ ë‚´ ë‹¨ì²´ ëŒ€í™” ë©”ì‹œì§€)
- ConversationCard (ëŒ€í™” ì¹´ë“œ)

**ê°’ ê°ì²´**:
- MessageContent (ìµœëŒ€ 300ì)
- MessageType (TEXT, CARD_SHARED, SYSTEM)
- ExpirationTime (3ì¼)

**ë¶ˆë³€ì‹**:
- ë©”ì‹œì§€ëŠ” ìµœëŒ€ 300ì
- ì±„íŒ… ë©”ì‹œì§€ëŠ” 3ì¼ í›„ ìë™ ì‚­ì œ
- ë©”ì‹œì§€ëŠ” ì²´ë¥˜ ì¤‘ì¸ ë£¸ì—ë§Œ ì „ì†¡ ê°€ëŠ¥

**ë„ë©”ì¸ ë¡œì§**:
- **ë©”ì‹œì§€ ì „ì†¡**: ë£¸ ë‚´ ëª¨ë“  ì—¬í–‰ìì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
- **ëŒ€í™” ì¹´ë“œ ê³µìœ **: ëœë¤ ì¹´ë“œ ì„ íƒ í›„ ë£¸ì— ê³µìœ 
- **ë©”ì‹œì§€ ë§Œë£Œ**: 3ì¼ í›„ ìë™ ì‚­ì œ

### 5. DirectMessage Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: DirectMessageRoom

**ì—”í‹°í‹°**:
- DirectMessageRoom (1:1 ëŒ€í™”ë°©)
- DirectMessage (1:1 ë©”ì‹œì§€)

**ê°’ ê°ì²´**:
- MessageContent (ìµœëŒ€ 300ì)
- DMStatus (PENDING, ACCEPTED, REJECTED, ACTIVE, ENDED)

**ë¶ˆë³€ì‹**:
- ë©”ì‹œì§€ëŠ” ìµœëŒ€ 300ì
- 1:1 ëŒ€í™”ëŠ” ê°™ì€ ë£¸ ë‚´ì—ì„œë§Œ ê°€ëŠ¥
- 1:1 ëŒ€í™”ëŠ” ì²´í¬ì•„ì›ƒ ì‹œ ì‚­ì œ

**ë„ë©”ì¸ ë¡œì§**:
- **ëŒ€í™” ì‹ ì²­**: ê°™ì€ ë£¸ ì—¬í–‰ìì—ê²Œ 1:1 ëŒ€í™” ì‹ ì²­
- **ìˆ˜ë½/ê±°ì ˆ**: ìˆ˜ë½ ì‹œ ëŒ€í™”ë°© í™œì„±í™”
- **ë©”ì‹œì§€ ì „ì†¡**: ëŒ€í™”ë°© ë‚´ ë‘ ì—¬í–‰ì ê°„ ë©”ì‹œì§€ êµí™˜
- **ëŒ€í™”ë°© ì¢…ë£Œ**: ì²´í¬ì•„ì›ƒ ì‹œ ìë™ ì‚­ì œ

### 6. Reflection Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: Diary, Questionnaire

**ì—”í‹°í‹°**:
- Diary (ì¼ê¸°)
- Questionnaire (ë¬¸ë‹µì§€)

**ê°’ ê°ì²´**:
- DiaryContent (ìµœëŒ€ 500ì)
- DiaryMood (ì´ëª¨ì§€)
- QuestionnaireAnswer (ìµœëŒ€ 200ì)
- DiaryDate

**ë¶ˆë³€ì‹**:
- ì¼ê¸°ëŠ” í•˜ë£¨ 1ê°œ (user_id, diary_date ìœ ì¼)
- ë¬¸ë‹µì§€ëŠ” ë„ì‹œë³„ 1ê°œ (user_id, city_id ìœ ì¼)
- ì¼ê¸°ëŠ” 500ì, ë¬¸ë‹µì§€ ë‹µë³€ì€ 200ì
- ì¼ê¸°/ë¬¸ë‹µì§€ëŠ” ë³¸ì¸ë§Œ ì¡°íšŒ ê°€ëŠ¥

**ë„ë©”ì¸ ë¡œì§**:
- **ì¼ê¸° ì‘ì„±**: í•˜ë£¨ 1íšŒ í¬ì¸íŠ¸ íšë“ (50P)
- **ë¬¸ë‹µì§€ ì‘ì„±**: ë„ì‹œë³„ 1íšŒ í¬ì¸íŠ¸ íšë“ (50P)

### 7. Point Aggregate

**ì• ê·¸ë¦¬ê²Œì´íŠ¸ ë£¨íŠ¸**: User (í¬ì¸íŠ¸ ì”ì•¡ í¬í•¨)

**ì—”í‹°í‹°**:
- PointTransaction (í¬ì¸íŠ¸ ê±°ë˜)

**ê°’ ê°ì²´**:
- TransactionType (EARN, SPEND)
- TransactionReason (SIGNUP, DIARY, QUESTIONNAIRE, TICKET, EXTENSION)
- TransactionStatus (PENDING, COMPLETED, FAILED)

**ë¶ˆë³€ì‹**:
- í¬ì¸íŠ¸ëŠ” ìŒìˆ˜ê°€ ë  ìˆ˜ ì—†ìŒ
- í¬ì¸íŠ¸ ë¶€ì¡± ì‹œ ê²°ì œ ë¶ˆê°€
- ëª¨ë“  ê±°ë˜ëŠ” íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬

**ë„ë©”ì¸ ë¡œì§**:
- **í¬ì¸íŠ¸ íšë“**: SIGNUP(1000P), DIARY(50P/ì¼), QUESTIONNAIRE(50P/ë„ì‹œ)
- **í¬ì¸íŠ¸ ì‚¬ìš©**: TICKET(300P/500P), EXTENSION(300P)
- **ì”ì•¡ ê³„ì‚°**: balance_after = balance_before + amount (EARN) ë˜ëŠ” - amount (SPEND)

---

## ë„ë©”ì¸ ëª¨ë¸ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph UserAggregate[User Aggregate]
        User[User<br/>ì—¬í–‰ì<br/>AR]
        Email[Email<br/>VO]
        Nickname[Nickname<br/>VO]
        Points[PointBalance<br/>VO]
        User --> Email
        User --> Nickname
        User --> Points
    end

    subgraph TravelAggregate[Travel Aggregate]
        Ticket[Ticket<br/>í‹°ì¼“<br/>AR]
        City[City<br/>ë„ì‹œ]
        Ticket --> City
    end

    subgraph RoomAggregate[Room Aggregate]
        Room[Room<br/>ë£¸<br/>ì²´ë¥˜+ëŒ€í™” ê³µê°„<br/>AR]
        RoomStay[RoomStay<br/>ì²´ë¥˜ ê¸°ë¡]
        Guesthouse[Guesthouse<br/>ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤]
        RoomCapacity[Capacity<br/>VO]
        CheckInOut[CheckInOut<br/>VO]
        Room --> Guesthouse
        Room --> RoomStay
        Room --> RoomCapacity
        RoomStay --> CheckInOut
    end

    subgraph ChatAggregate[Chat Aggregate]
        ChatMessage[ChatMessage<br/>ë‹¨ì²´ ë©”ì‹œì§€<br/>AR]
        ConversationCard[ConversationCard<br/>ëŒ€í™” ì¹´ë“œ]
        ChatContent[MessageContent<br/>VO]
        ChatMessage --> ConversationCard
        ChatMessage --> ChatContent
    end

    subgraph DMAggregate[DirectMessage Aggregate]
        DMRoom[DMRoom<br/>1:1 ëŒ€í™”ë°©<br/>AR]
        DirectMessage[DirectMessage<br/>1:1 ë©”ì‹œì§€]
        DMContent[MessageContent<br/>VO]
        DMRoom --> DirectMessage
        DirectMessage --> DMContent
    end

    subgraph ReflectionAggregate[Reflection Aggregate]
        Diary[Diary<br/>ì¼ê¸°<br/>AR]
        Questionnaire[Questionnaire<br/>ë¬¸ë‹µì§€<br/>AR]
        DiaryContent[DiaryContent<br/>VO]
        QuestionAnswer[QuestionAnswer<br/>VO]
        Diary --> DiaryContent
        Questionnaire --> QuestionAnswer
    end

    subgraph PointAggregate[Point Aggregate]
        PointTransaction[PointTransaction<br/>í¬ì¸íŠ¸ ê±°ë˜]
        TransactionType[TransactionType<br/>VO]
        TransactionReason[TransactionReason<br/>VO]
        PointTransaction --> TransactionType
        PointTransaction --> TransactionReason
    end

    User -->|êµ¬ë§¤| Ticket
    Ticket -->|ì²´í¬ì¸| RoomStay
    User -->|ì²´ë¥˜| RoomStay
    User -->|ì—°ì¥| RoomStay
    RoomStay -.->|ì†Œì† ë£¸| Room
    RoomStay -.->|ì—°ì¥ ì‹œ<br/>í¬ì¸íŠ¸ ì°¨ê°| PointTransaction
    ChatMessage -.->|ì „ì†¡ëœ ë£¸| Room
    DMRoom -.->|ìƒì„±ëœ ë£¸| Room
    User -->|ì‘ì„±| Diary
    User -->|ì‘ì„±| Questionnaire
    User -->|ê±°ë˜| PointTransaction
    Ticket -.->|êµ¬ë§¤ ì‹œ<br/>í¬ì¸íŠ¸ ì°¨ê°| PointTransaction
    Diary -.->|ì‘ì„± ì‹œ<br/>í¬ì¸íŠ¸ íšë“| PointTransaction
    Questionnaire -.->|ì™„ì„± ì‹œ<br/>í¬ì¸íŠ¸ íšë“| PointTransaction

    style UserAggregate fill:#e1f5ff
    style TravelAggregate fill:#fff4e1
    style RoomAggregate fill:#ffe1e1
    style ChatAggregate fill:#e1ffe1
    style DMAggregate fill:#d4f1e1
    style ReflectionAggregate fill:#f4e1ff
    style PointAggregate fill:#ffe1f4
```

**ë²”ë¡€**:
- **AR**: Aggregate Root
- **VO**: Value Object
- ì‹¤ì„ : ê°•í•œ ì—°ê´€
- ì ì„ : ì•½í•œ ì—°ê´€

---

## ì—”í‹°í‹° (Entities)

### User (ì—¬í–‰ì)

**ì‹ë³„ì**: user_id (UUID v7)

**ì†ì„±**:
- email: Email (VO)
- password_hash: String
- nickname: Nickname (VO)
- profile_emoji: ProfileEmoji (VO)
- current_points: PointBalance (VO)
- is_active: Boolean

**ì±…ì„**:
- íšŒì›ê°€ì…/ë¡œê·¸ì¸
- í”„ë¡œí•„ ê´€ë¦¬
- í¬ì¸íŠ¸ ì”ì•¡ ê´€ë¦¬

### City (ë„ì‹œ)

**ì‹ë³„ì**: city_id (UUID v7)

**ì†ì„±**:
- name: String (ì˜ˆ: ì„¸ë Œì‹œì•„)
- theme: String (ì˜ˆ: ê´€ê³„ì˜ ë„ì‹œ)
- description: Text
- image_url: String
- base_cost_points: Integer (ê¸°ì¤€ ê°€ê²©, ì˜ˆ: 100P)
- base_duration_hours: Integer (ê¸°ì¤€ ë¹„í–‰ ì‹œê°„, ì˜ˆ: 1ì‹œê°„)
- is_active: Boolean
- display_order: Integer (ë„ì‹œ í‘œì‹œ ìˆœì„œ)

**ì±…ì„**:
- ë„ì‹œ ì •ë³´ ì œê³µ
- ê¸°ì¤€ ê°€ê²© ë° ê¸°ì¤€ ë¹„í–‰ ì‹œê°„ ì œê³µ
- í™œì„±í™” ìƒíƒœ ê´€ë¦¬
- ë„ì‹œ í‘œì‹œ ìˆœì„œ ê´€ë¦¬

### Airship (ë¹„í–‰ì„ )

**ì‹ë³„ì**: airship_id (UUID v7)

**ì†ì„±**:
- name: String (ì˜ˆ: "ì¼ë°˜ ë¹„í–‰ì„ ", "ê³ ì† ë¹„í–‰ì„ ")
- description: Text
- image_url: String
- cost_factor: Integer (ê°€ê²© ë°°ìˆ˜, ì˜ˆ: 1, 2)
- duration_factor: Integer (ì‹œê°„ ë°°ìˆ˜, ì˜ˆ: 3, 1)
- display_order: Integer (í‘œì‹œ ìˆœì„œ)
- is_active: Boolean

**ì±…ì„**:
- ë¹„í–‰ì„  íƒ€ì… ì •ë³´ ì œê³µ
- ê°€ê²© ë° ì‹œê°„ ë°°ìˆ˜ ì œê³µ
- í™œì„±í™” ìƒíƒœ ê´€ë¦¬

**ì‹œë“œ ë°ì´í„°**:
- ì¼ë°˜ ë¹„í–‰ì„ : cost_factor=1, duration_factor=3
- ê³ ì† ë¹„í–‰ì„ : cost_factor=2, duration_factor=1

### Ticket (í‹°ì¼“)

**ì‹ë³„ì**: ticket_id (UUID v7)

**ì†ì„±**:
- user_id: UUID (FK)
- city_id: UUID (FK)
- airship_id: UUID (FK)
- ticket_number: String (ì¥ì‹ìš©, ì˜ˆ: "B0-2025-001234")
- cost_points: Integer (ê³„ì‚°ë¨: City.base_cost_points Ã— Airship.cost_factor)
- departure_time: DateTime
- arrival_time: DateTime (ê³„ì‚°ë¨: departure_time + City.base_duration_hours Ã— Airship.duration_factor)
- status: TicketStatus (VO)

**ì±…ì„**:
- í‹°ì¼“ ë°œê¶Œ
- í‹°ì¼“ ë²ˆí˜¸ ìƒì„± (í˜•ì‹: "B0-{ë…„ë„}-{ì¼ë ¨ë²ˆí˜¸}")
- ë¹„ìš© ë° ì´ë™ ì‹œê°„ ê³„ì‚° (City Ã— Airship factor)
- ë„ì°© ì²˜ë¦¬

### Guesthouse (ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤)

**ì‹ë³„ì**: guesthouse_id (UUID v7)

**ì†ì„±**:
- city_id: UUID (FK)
- name: String
- guesthouse_type: GuesthouseType (MIXED, QUIET)
- description: Text
- image_url: String
- is_active: Boolean

**ì±…ì„**:
- ë„ì‹œì˜ ì˜êµ¬ì ì¸ ìˆ™ì†Œ ì»¨í…Œì´ë„ˆ
- ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ì •ë³´ ì œê³µ
- íƒ€ì…ë³„ íŠ¹ì„± ì •ì˜ (í˜¼í•©í˜•/ì¡°ìš©í•œ ë°©)
- Roomë“¤ì˜ ìƒìœ„ ê·¸ë£¹

**ìƒëª…ì£¼ê¸°**: ì˜êµ¬ì  (ì‚­ì œë˜ì§€ ì•ŠìŒ)

### Room (ë£¸)

**ì‹ë³„ì**: room_id (UUID v7)

**ì†ì„±**:
- guesthouse_id: UUID (FK)
- room_name: String
- room_number: Integer (ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ë³„ ì¦ê°€)
- max_capacity: Integer (ê¸°ë³¸ 6)
- current_capacity: Integer
- status: RoomStatus (VO)

**ì±…ì„**:
- ì—¬í–‰ìë“¤ì´ ì²´ë¥˜í•˜ëŠ” ë™ì  ê³µê°„
- ë‹¨ì²´ ëŒ€í™”ê°€ ì´ë£¨ì–´ì§€ëŠ” ê³µê°„
- 1:1 ëŒ€í™”ê°€ ì‹œì‘ë˜ëŠ” ê³µê°„
- ë£¸ ì •ì› ê´€ë¦¬ (ìµœëŒ€ 6ëª…)
- ë£¸ ìƒíƒœ ê´€ë¦¬ (ACTIVE, FULL)

**ìƒëª…ì£¼ê¸°**:
- **ìƒì„±**: ì²« ë²ˆì§¸ ì—¬í–‰ì ì²´í¬ì¸ ì‹œ
- **í™œì„±**: 1ëª… ì´ìƒ ì²´ë¥˜ ì¤‘
- **ë§Œì›**: 6ëª… ì²´ë¥˜ ì¤‘ (ìƒˆ ì—¬í–‰ì ë°°ì • ë¶ˆê°€)
- **ì‚­ì œ**: ë§ˆì§€ë§‰ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ `deleted_at` ì„¤ì • (soft delete), ë°°ì¹˜ë¡œ ì‹¤ì œ ì‚­ì œ

### RoomStay (ì²´ë¥˜)

**ì‹ë³„ì**: stay_id (UUID v7)

**ì†ì„±**:
- room_id: UUID (FK)
- user_id: UUID (FK)
- ticket_id: UUID (FK)
- check_in_time: DateTime (ê°œë³„)
- scheduled_checkout_time: DateTime (ê°œë³„)
- actual_checkout_time: DateTime (nullable)
- extension_count: Integer (ê°œë³„, ê¸°ë³¸ê°’ 0)
- total_extension_cost: Integer (ê°œë³„, ê¸°ë³¸ê°’ 0)
- status: RoomStayStatus (VO)

**ì±…ì„**:
- **ê°œë³„ ì—¬í–‰ìì˜ ì²´ë¥˜ ê¸°ë¡ ê´€ë¦¬**
- ê° ì—¬í–‰ìì˜ ê³ ìœ í•œ ì²´í¬ì¸ ì‹œê°„ ê¸°ë¡
- ê° ì—¬í–‰ìì˜ ê³ ìœ í•œ ì²´í¬ì•„ì›ƒ ì‹œê°„ ê³„ì‚° (ì²´í¬ì¸ + 24ì‹œê°„)
- ê°œë³„ ì—°ì¥ ì²˜ë¦¬ (300P/24ì‹œê°„)
- ê°œë³„ ì²´í¬ì•„ì›ƒ ì²˜ë¦¬ (ìë™ ë˜ëŠ” ìˆ˜ë™)

**ë„ë©”ì¸ ë¡œì§**:
- **extend()**: ì²´ë¥˜ ì—°ì¥
  - scheduled_checkout_timeì— 24ì‹œê°„ ì¶”ê°€
  - extension_count ì¦ê°€
  - total_extension_costì— 300P ëˆ„ì 
  - í¬ì¸íŠ¸ ì°¨ê°ì€ PointTransactionServiceë¥¼ í†µí•´ ì²˜ë¦¬
- **checkout()**: ì²´í¬ì•„ì›ƒ ì²˜ë¦¬
  - statusë¥¼ CHECKED_OUTìœ¼ë¡œ ë³€ê²½
  - actual_checkout_time ê¸°ë¡

**ë¶ˆë³€ì‹**:
- í•œ ì—¬í–‰ìëŠ” ë™ì‹œì— í•˜ë‚˜ì˜ í™œì„± ì²´ë¥˜ë§Œ ê°€ëŠ¥
- scheduled_checkout_time = check_in_time + 24ì‹œê°„ + (extension_count Ã— 24ì‹œê°„)
- extension_count >= 0
- total_extension_cost = extension_count Ã— 300P

### ChatMessage (ë‹¨ì²´ ëŒ€í™” ë©”ì‹œì§€)

**ì‹ë³„ì**: message_id (UUID v7)

**ì†ì„±**:
- room_id: UUID (FK)
- user_id: UUID (FK)
- content: MessageContent (VO)
- card_id: UUID (FK, nullable)
- message_type: MessageType (VO)
- is_system: Boolean
- expires_at: DateTime

**ì±…ì„**:
- ë£¸ ë‚´ ëª¨ë“  ì—¬í–‰ìì—ê²Œ ë©”ì‹œì§€ ì „ì†¡
- ë©”ì‹œì§€ ë§Œë£Œ (3ì¼ í›„ ìë™ ì‚­ì œ)
- ëŒ€í™” ì¹´ë“œ ê³µìœ 

### ConversationCard (ëŒ€í™” ì¹´ë“œ)

**ì‹ë³„ì**: card_id (UUID v7)

**ì†ì„±**:
- city_id: UUID (FK, nullable)
- question: Text
- category: String
- is_active: Boolean

**ì±…ì„**:
- ë£¸ ë‚´ ë‹¨ì²´ ëŒ€í™”ë¥¼ ìœ„í•œ ì£¼ì œ ì œê³µ
- ë„ì‹œë³„/ê³µìš© ì¹´ë“œ ê´€ë¦¬
- ëœë¤ ì¹´ë“œ ì„ íƒ

### DirectMessageRoom (1:1 ëŒ€í™”ë°©)

**ì‹ë³„ì**: dm_room_id (UUID v7)

**ì†ì„±**:
- guesthouse_id: UUID (FK)
- room_id: UUID (FK)
- user1_id: UUID (FK, ì‹ ì²­ì)
- user2_id: UUID (FK, ìˆ˜ì‹ ì)
- status: DMStatus (VO)
- started_at: DateTime
- ended_at: DateTime

**ì±…ì„**:
- ê°™ì€ ë£¸ ë‚´ ì—¬í–‰ì ê°„ 1:1 ëŒ€í™”ë°© ìƒì„±
- ëŒ€í™” ì‹ ì²­/ìˆ˜ë½/ê±°ì ˆ ê´€ë¦¬
- ì²´í¬ì•„ì›ƒ ì‹œ ëŒ€í™”ë°© ìë™ ì‚­ì œ

### DirectMessage (1:1 ë©”ì‹œì§€)

**ì‹ë³„ì**: dm_id (UUID v7)

**ì†ì„±**:
- dm_room_id: UUID (FK)
- from_user_id: UUID (FK)
- to_user_id: UUID (FK)
- content: MessageContent (VO)
- is_read: Boolean

**ì±…ì„**:
- 1:1 ë©”ì‹œì§€ ì „ì†¡
- ì½ìŒ ì²˜ë¦¬

### Diary (ì¼ê¸°)

**ì‹ë³„ì**: diary_id (UUID v7)

**ì†ì„±**:
- user_id: UUID (FK)
- title: String (nullable)
- content: DiaryContent (VO)
- mood: DiaryMood (VO)
- diary_date: Date
- city_id: UUID (FK, nullable)
- has_earned_points: Boolean

**ì±…ì„**:
- ì¼ê¸° ì‘ì„±
- í•˜ë£¨ 1íšŒ í¬ì¸íŠ¸ íšë“ ì œí•œ
- ë³¸ì¸ë§Œ ì¡°íšŒ ê°€ëŠ¥

**ë¶ˆë³€ì‹**:
- (user_id, diary_date) ìœ ì¼

### Questionnaire (ë¬¸ë‹µì§€)

**ì‹ë³„ì**: questionnaire_id (UUID v7)

**ì†ì„±**:
- user_id: UUID (FK)
- city_id: UUID (FK)
- question_1_answer: QuestionAnswer (VO)
- question_2_answer: QuestionAnswer (VO)
- question_3_answer: QuestionAnswer (VO)
- has_earned_points: Boolean

**ì±…ì„**:
- ë¬¸ë‹µì§€ ì‘ì„±
- ë„ì‹œë³„ 1íšŒ í¬ì¸íŠ¸ íšë“ ì œí•œ
- ë³¸ì¸ë§Œ ì¡°íšŒ ê°€ëŠ¥

**ë¶ˆë³€ì‹**:
- (user_id, city_id) ìœ ì¼

### PointTransaction (í¬ì¸íŠ¸ ê±°ë˜)

**ì‹ë³„ì**: transaction_id (UUID v7)

**ì†ì„±**:
- user_id: UUID (FK)
- transaction_type: TransactionType (VO)
- amount: Integer
- reason: TransactionReason (VO)
- reference_type: String
- reference_id: UUID
- balance_before: Integer
- balance_after: Integer
- status: TransactionStatus (VO)
- description: Text (ê±°ë˜ ì„¤ëª…, ì„ íƒ ì‚¬í•­)

**ì±…ì„**:
- í¬ì¸íŠ¸ ê±°ë˜ ê¸°ë¡
- ì”ì•¡ ê³„ì‚°
- íŠ¸ëœì­ì…˜ ë¬´ê²°ì„± ë³´ì¥
- ê±°ë˜ ìƒì„¸ ë‚´ì—­ ê´€ë¦¬

---

## ê°’ ê°ì²´ (Value Objects)

### Email

**ì†ì„±**: value (String)

**ê²€ì¦**:
- ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
- ìµœëŒ€ 255ì

### Nickname

**ì†ì„±**: value (String)

**ê²€ì¦**:
- 2-10ì ì œí•œ
- ìš•ì„¤ í•„í„°ë§

### ProfileEmoji

**ì†ì„±**: value (String)

**ê²€ì¦**:
- 10ê°œ ì´ëª¨ì§€ ì¤‘ ì„ íƒ

### PointBalance

**ì†ì„±**: value (Integer)

**ê²€ì¦**:
- 0 ì´ìƒ

### TicketStatus

**ì†ì„±**: PURCHASED, BOARDING, COMPLETED, CANCELED

**ìƒíƒœ ì „ì´**:
- PURCHASED â†’ BOARDING: ë¹„í–‰ì„  ì¶œë°œ ì‹œ
- BOARDING â†’ COMPLETED: ë¹„í–‰ì„  ë„ì°© ì‹œ
- PURCHASED â†’ CANCELED: í‹°ì¼“ ì·¨ì†Œ ì‹œ

### RoomCapacity

**ì†ì„±**: max (Integer), current (Integer)

**ê²€ì¦**:
- max: 6ëª…
- current <= max

### RoomStatus

**ì†ì„±**: ACTIVE, FULL

**ì„¤ëª…**:
- ACTIVE: 1~5ëª… ì²´ë¥˜ ì¤‘ (ìƒˆ ì—¬í–‰ì ë°°ì • ê°€ëŠ¥)
- FULL: 6ëª… ì²´ë¥˜ ì¤‘ (ìƒˆ ì—¬í–‰ì ë°°ì • ë¶ˆê°€)
- ì‚­ì œ: 0ëª… ì²´ë¥˜ ì‹œ ë£¸ì˜ `deleted_at` ì„¤ì • (soft delete, ë°°ì¹˜ë¡œ ì‹¤ì œ ì‚­ì œ)

### RoomStayStatus

**ì†ì„±**: CHECKED_IN, CHECKED_OUT

### MessageContent

**ì†ì„±**: value (String)

**ê²€ì¦**:
- ìµœëŒ€ 300ì

### MessageType

**ì†ì„±**: TEXT, CARD_SHARED, SYSTEM

### DMStatus

**ì†ì„±**: PENDING, ACCEPTED, REJECTED, ACTIVE, ENDED

### DiaryContent

**ì†ì„±**: value (String)

**ê²€ì¦**:
- ìµœëŒ€ 500ì

### DiaryMood

**ì†ì„±**: value (String)

**ê²€ì¦**:
- ì´ëª¨ì§€ ì„ íƒ

### QuestionAnswer

**ì†ì„±**: value (String)

**ê²€ì¦**:
- ìµœëŒ€ 200ì

### TransactionType

**ì†ì„±**: EARN, SPEND

### TransactionReason

**ì†ì„±**: SIGNUP, DIARY, QUESTIONNAIRE, TICKET, EXTENSION

### TransactionStatus

**ì†ì„±**: PENDING, COMPLETED, FAILED

---

## ë„ë©”ì¸ ì´ë²¤íŠ¸ (Domain Events)

### User Domain Events

- **UserRegistered**: ì‚¬ìš©ì ë“±ë¡ ì™„ë£Œ (1000P ì§€ê¸‰)
- **UserLoggedIn**: ì‚¬ìš©ì ë¡œê·¸ì¸
- **UserProfileUpdated**: í”„ë¡œí•„ ë³€ê²½

### Travel Domain Events

- **TicketPurchased**: í‹°ì¼“ êµ¬ë§¤ ì™„ë£Œ (í¬ì¸íŠ¸ ì°¨ê°)
- **AirshipDeparted**: ë¹„í–‰ì„  ì¶œë°œ
- **AirshipArrived**: ë¹„í–‰ì„  ë„ì°© (ìë™ ì²´í¬ì¸ íŠ¸ë¦¬ê±°)

### Room Domain Events

- **RoomCreated**: ì²« ë²ˆì§¸ ì—¬í–‰ì ì²´í¬ì¸ ì‹œ ë£¸ ìƒì„±
- **UserCheckedIn**: ê°œë³„ ì—¬í–‰ì ì²´í¬ì¸ ì™„ë£Œ
  - 24ì‹œê°„ í›„ ì²´í¬ì•„ì›ƒ ì˜ˆì•½
  - ì²´í¬ì•„ì›ƒ ì•Œë¦¼ íƒœìŠ¤í¬ ì˜ˆì•½ (23ì‹œê°„ í›„)
- **RoomAutoAssigned**: ë£¸ ìë™ ë°°ì • ì™„ë£Œ
- **StayExtended**: ê°œë³„ ì—¬í–‰ì ì²´ë¥˜ ì—°ì¥
  - í¬ì¸íŠ¸ 300P ì°¨ê°
  - scheduled_checkout_timeì´ 24ì‹œê°„ ì—°ì¥
  - extension_count ì¦ê°€
  - total_extension_cost ëˆ„ì 
  - ê¸°ì¡´ ì•Œë¦¼ íƒœìŠ¤í¬ ì·¨ì†Œ ë° ì¬ì˜ˆì•½
- **CheckoutReminderSent**: ì²´í¬ì•„ì›ƒ 1ì‹œê°„ ì „ ì•Œë¦¼ ë°œì†¡
- **CheckoutScheduled**: ê°œë³„ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì˜ˆì•½
- **UserCheckedOut**: ê°œë³„ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì™„ë£Œ (ìë™ ë˜ëŠ” ìˆ˜ë™)
  - RoomStay ìƒíƒœë¥¼ CHECKED_OUTìœ¼ë¡œ ë³€ê²½
  - Roomì˜ current_capacity ê°ì†Œ
  - í•´ë‹¹ ì—¬í–‰ìì˜ 1:1 ëŒ€í™”ë°© ì‚­ì œ
- **RoomBecameFull**: ë£¸ ì •ì› 6ëª… ë„ë‹¬ (ìƒˆ ë°°ì • ë¶ˆê°€)
- **RoomDeleted**: ë§ˆì§€ë§‰ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ ë£¸ soft delete (current_capacity = 0, deleted_at ì„¤ì •)

### Chat Domain Events

- **ChatMessageSent**: ë£¸ ë‚´ ë‹¨ì²´ ë©”ì‹œì§€ ì „ì†¡
- **ConversationCardShared**: ëŒ€í™” ì¹´ë“œ ê³µìœ 
- **ChatMessageExpired**: ë©”ì‹œì§€ ë§Œë£Œ (3ì¼)

### DirectMessage Domain Events

- **DMRequestSent**: 1:1 ëŒ€í™” ì‹ ì²­
- **DMRequestAccepted**: 1:1 ëŒ€í™” ìˆ˜ë½
- **DMRequestRejected**: 1:1 ëŒ€í™” ê±°ì ˆ
- **DMRoomCreated**: 1:1 ëŒ€í™”ë°© ìƒì„±
- **DMMessageSent**: 1:1 ë©”ì‹œì§€ ì „ì†¡
- **DMRoomEnded**: 1:1 ëŒ€í™”ë°© ì¢…ë£Œ (ì²´í¬ì•„ì›ƒ ì‹œ)

### Reflection Domain Events

- **DiaryCreated**: ì¼ê¸° ì‘ì„± ì™„ë£Œ (í¬ì¸íŠ¸ íšë“)
- **QuestionnaireCompleted**: ë¬¸ë‹µì§€ ì‘ì„± ì™„ë£Œ (í¬ì¸íŠ¸ íšë“)

### Point Domain Events

- **PointsEarned**: í¬ì¸íŠ¸ íšë“
- **PointsSpent**: í¬ì¸íŠ¸ ì‚¬ìš©
- **InsufficientPoints**: í¬ì¸íŠ¸ ë¶€ì¡±

---

## ë„ë©”ì¸ ì„œë¹„ìŠ¤ (Domain Services)

ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” íŠ¹ì • ì—”í‹°í‹°ì— ì†í•˜ì§€ ì•ŠëŠ” ë„ë©”ì¸ ë¡œì§ì„ ìº¡ìŠí™”í•©ë‹ˆë‹¤.

### RoomAssignmentService (ë£¸ ìë™ ë°°ì • ì„œë¹„ìŠ¤)

**ì±…ì„**: ì—¬í–‰ìê°€ ë„ì°©í–ˆì„ ë•Œ ì ì ˆí•œ ë£¸ì— ìë™ìœ¼ë¡œ ë°°ì • (ë˜ëŠ” ìƒˆ ë£¸ ìƒì„±)

**ì£¼ìš” ë¡œì§**:
- ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë‚´ 6ëª… ë¯¸ë§Œì¸ í™œì„± ë£¸ ì°¾ê¸°
- ê°€ìš©í•œ ë£¸ì´ ìˆìœ¼ë©´ í•´ë‹¹ ë£¸ì— ë°°ì •
- ê°€ìš©í•œ ë£¸ì´ ì—†ìœ¼ë©´ ìƒˆ ë£¸ ìƒì„± í›„ ë°°ì •
- ë™ì‹œì— ì—¬ëŸ¬ ì—¬í–‰ìê°€ ë„ì°©í•´ë„ Race Condition ì—†ì´ ì•ˆì „í•˜ê²Œ ë°°ì •
- ë£¸ ì •ì› ì—…ë°ì´íŠ¸ (current_capacity ì¦ê°€)
- 6ëª… ë„ë‹¬ ì‹œ ë£¸ ìƒíƒœë¥¼ FULLë¡œ ë³€ê²½

### StayExtensionService (ì²´ë¥˜ ì—°ì¥ ì„œë¹„ìŠ¤)

**ì±…ì„**: ì—¬í–‰ìì˜ ì²´ë¥˜ ì—°ì¥ ìš”ì²­ ì²˜ë¦¬

**ì£¼ìš” ë¡œì§**:
- **í¬ì¸íŠ¸ ê²€ì¦**: ë³´ìœ  í¬ì¸íŠ¸ê°€ 300P ì´ìƒì¸ì§€ í™•ì¸
- **í¬ì¸íŠ¸ ì°¨ê°**: PointTransactionServiceë¥¼ í†µí•´ 300P ì°¨ê°
- **ì²´í¬ì•„ì›ƒ ì‹œê°„ ì—°ì¥**: scheduled_checkout_timeì— 24ì‹œê°„ ì¶”ê°€
- **ì—°ì¥ ê¸°ë¡**: extension_count ì¦ê°€, total_extension_costì— 300P ëˆ„ì 
- **ì´ë²¤íŠ¸ ë°œí–‰**: StayExtended ì´ë²¤íŠ¸
- **ì—°ì¥ ì œí•œ ì—†ìŒ**: í¬ì¸íŠ¸ë§Œ ìˆìœ¼ë©´ ë¬´ì œí•œ ì—°ì¥ ê°€ëŠ¥

**ì—°ì¥ ê³µì‹**:
```
ìƒˆë¡œìš´ ì²´í¬ì•„ì›ƒ ì‹œê°„ = í˜„ì¬ scheduled_checkout_time + 24ì‹œê°„
```

### CheckoutService (ì²´í¬ì•„ì›ƒ ì„œë¹„ìŠ¤)

**ì±…ì„**: ê° ì—¬í–‰ìì˜ ì˜ˆì •ëœ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì²´í¬ì•„ì›ƒ ì²˜ë¦¬

**ì£¼ìš” ë¡œì§**:
- **ê°œë³„ ì²´í¬ì¸ ì‹œ**: í•´ë‹¹ ì—¬í–‰ìì˜ 24ì‹œê°„ í›„ ì²´í¬ì•„ì›ƒ ì˜ˆì•½
- **1ì‹œê°„ ì „ ì•Œë¦¼**: ê° ì—¬í–‰ìì—ê²Œ ê°œë³„ ì•Œë¦¼ ë°œì†¡
- **ìë™ ì²´í¬ì•„ì›ƒ**: ì˜ˆì • ì‹œê°„ ë„ë‹¬ ì‹œ í•´ë‹¹ ì—¬í–‰ìë§Œ ì²´í¬ì•„ì›ƒ ì²˜ë¦¬
- **ë£¸ ì •ì› ê°ì†Œ**: current_capacity ê°ì†Œ
- **1:1 ëŒ€í™”ë°© ì‚­ì œ**: ì²´í¬ì•„ì›ƒí•œ ì—¬í–‰ìì˜ 1:1 ëŒ€í™”ë°© ìë™ ì‚­ì œ
- **ë£¸ ì‚­ì œ**: ë§ˆì§€ë§‰ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ (current_capacity = 0) ë£¸ì˜ `deleted_at` ì„¤ì • (soft delete)

### PointTransactionService (í¬ì¸íŠ¸ ê±°ë˜ ì„œë¹„ìŠ¤)

**ì±…ì„**: í¬ì¸íŠ¸ íšë“ ë° ì‚¬ìš©ì„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬

**ì£¼ìš” ë¡œì§**:
- **í¬ì¸íŠ¸ íšë“**: ì”ì•¡ ì¦ê°€, ê±°ë˜ ê¸°ë¡ ìƒì„±, ì´ì „/ì´í›„ ì”ì•¡ ê¸°ë¡
- **í¬ì¸íŠ¸ ì‚¬ìš©**: ì”ì•¡ í™•ì¸, ë¶€ì¡± ì‹œ ì˜ˆì™¸ ë°œìƒ, ì”ì•¡ ì°¨ê°, ê±°ë˜ ê¸°ë¡ ìƒì„±
- ë™ì‹œì„± ì œì–´ë¡œ í¬ì¸íŠ¸ ë¬´ê²°ì„± ë³´ì¥
- ìŒìˆ˜ ì”ì•¡ ë°©ì§€

### MessageExpirationService (ë©”ì‹œì§€ ë§Œë£Œ ì„œë¹„ìŠ¤)

**ì±…ì„**: ì˜¤ë˜ëœ ë©”ì‹œì§€ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œí•˜ì—¬ ì €ì¥ ê³µê°„ ê´€ë¦¬

**ì£¼ìš” ë¡œì§**:
- 3ì¼ ê²½ê³¼í•œ ì±„íŒ… ë©”ì‹œì§€ ê²€ìƒ‰
- ë§Œë£Œëœ ë©”ì‹œì§€ ì¼ê´„ ì‚­ì œ
- ë°°ì¹˜ ì‘ì—…ìœ¼ë¡œ ë§¤ì¼ ì‹¤í–‰

### ConversationCardService (ëŒ€í™” ì¹´ë“œ ì„œë¹„ìŠ¤)

**ì±…ì„**: ëŒ€í™” ì£¼ì œë¥¼ ìœ„í•œ ì¹´ë“œë¥¼ ëœë¤ìœ¼ë¡œ ì œê³µ

**ì£¼ìš” ë¡œì§**:
- ë„ì‹œë³„ í™œì„± ì¹´ë“œ ì¤‘ ëœë¤ ì„ íƒ
- ê³µìš© ì¹´ë“œë„ ì„ íƒ í’€ì— í¬í•¨
- ë™ì¼ ì¹´ë“œ ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥
- ë¬´ì œí•œ ì‚¬ìš© ê°€ëŠ¥ (MVPì—ì„œëŠ” ì‚¬ìš© ì œí•œ ì—†ìŒ)

### NotificationService (ì•Œë¦¼ ì„œë¹„ìŠ¤)

**ì±…ì„**: ì²´í¬ì•„ì›ƒ ì „ ì•Œë¦¼ ë° ê¸°íƒ€ ì‹œìŠ¤í…œ ì•Œë¦¼ ê´€ë¦¬

**ì£¼ìš” ë¡œì§**:
- **ì²´í¬ì•„ì›ƒ ì•Œë¦¼**: ì˜ˆì • ì‹œê°„ 1ì‹œê°„ ì „ ì•Œë¦¼ ë°œì†¡
- **êµ¬í˜„ ë°©ì‹**: Celery íƒœìŠ¤í¬ë¡œ ìŠ¤ì¼€ì¤„ë§
- **ì•Œë¦¼ ì±„ë„**: ì¸ì•± ì•Œë¦¼ (Phase 1), í‘¸ì‹œ/ì´ë©”ì¼ (Phase 2)
- ì²´í¬ì¸ ì‹œ ì²´í¬ì•„ì›ƒ ì•Œë¦¼ íƒœìŠ¤í¬ ì˜ˆì•½
- ì—°ì¥ ì‹œ ê¸°ì¡´ ì•Œë¦¼ ì·¨ì†Œ í›„ ì¬ì˜ˆì•½

### RateLimitingService (ì „ì†¡ ì œí•œ ì„œë¹„ìŠ¤)

**ì±…ì„**: ë©”ì‹œì§€ ì „ì†¡ ë° API í˜¸ì¶œ ì œí•œìœ¼ë¡œ ìŠ¤íŒ¸ ë°©ì§€

**ì£¼ìš” ë¡œì§**:
- **ë©”ì‹œì§€ ì „ì†¡**: 2ì´ˆì— 1íšŒ ì œí•œ
- **ëŒ€í™” ì‹ ì²­**: 1ë¶„ì— 3íšŒ ì œí•œ
- **êµ¬í˜„ ë°©ì‹**: Redisë¥¼ ì´ìš©í•œ Rate Limiting
- í‚¤ í˜•ì‹: `rate_limit:chat:{user_id}:{room_id}`
- TTL: ì œí•œ ì‹œê°„ë§Œí¼ ì„¤ì •
- ì œí•œ ì´ˆê³¼ ì‹œ 429 ì—ëŸ¬ ë°˜í™˜

### OnboardingService (ì˜¨ë³´ë”© ì„œë¹„ìŠ¤)

**ì±…ì„**: ì˜¨ë³´ë”© ìŠ¤í† ë¦¬ ë° ì´ˆê¸° ì‚¬ìš©ì ê²½í—˜ ê´€ë¦¬

**ì£¼ìš” ë¡œì§**:
- **ì˜¨ë³´ë”© ì´ë¯¸ì§€**: 3ì¥ì˜ ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ ì œê³µ
  - ì´ë¯¸ì§€ 1: ë°© ì•ˆ ì¹¨ëŒ€ (ì˜ë¬¸ì˜ í•¸ë“œí° ë°œê²¬)
  - ì´ë¯¸ì§€ 2: í•¸ë“œí° í´ë¡œì¦ˆì—… (B0 ì•±)
  - ì´ë¯¸ì§€ 3: B0 ë¹„í–‰ì„  í„°ë¯¸ë„ (ì´ˆëŒ€)
- **ì €ì¥ ë°©ì‹**: ì •ì  íŒŒì¼ (/static/onboarding/)
- **CDN**: Phase 2ì—ì„œ CloudFront ì ìš© ì˜ˆì •

### CityQuestionService (ë„ì‹œë³„ ì§ˆë¬¸ ì„œë¹„ìŠ¤)

**ì±…ì„**: ë„ì‹œë³„ ë¬¸ë‹µì§€ ì§ˆë¬¸ ê´€ë¦¬

**ì£¼ìš” ë¡œì§**:
- **ì„¸ë Œì‹œì•„ (ê´€ê³„ì˜ ë„ì‹œ)**:
  1. "ìš”ì¦˜ ë‚˜ì—ê²Œ í˜ì´ ë˜ì–´ì£¼ëŠ” ì‚¬ëŒì€?"
  2. "ìµœê·¼ì— ëˆ„êµ°ê°€ì™€ ë‚˜ëˆˆ ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ëŠ”?"
  3. "ê´€ê³„ì—ì„œ ë‚´ê°€ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€?"
- **ë¡œë Œì‹œì•„ (íšŒë³µì˜ ë„ì‹œ)**:
  1. "ìš”ì¦˜ ë‚˜ë¥¼ ê°€ì¥ ì§€ì¹˜ê²Œ í•˜ëŠ” ê²ƒì€?"
  2. "ë‚˜ë§Œì˜ íœ´ì‹ ë°©ë²•ì´ ìˆë‹¤ë©´?"
  3. "íšŒë³µì´ í•„ìš”í•  ë•Œ ê°€ì¥ ë¨¼ì € í•˜ê³  ì‹¶ì€ ì¼ì€?"
- ì§ˆë¬¸ì€ ì½”ë“œì—ì„œ ê´€ë¦¬ (DB ì €ì¥ ë¶ˆí•„ìš”)

---

## ë¦¬í¬ì§€í† ë¦¬ (Repositories)

ë¦¬í¬ì§€í† ë¦¬ëŠ” ì• ê·¸ë¦¬ê²Œì´íŠ¸ì˜ ì˜ì†ì„±ì„ ê´€ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ì¶”ìƒí™”í•˜ì—¬ ë„ë©”ì¸ ë¡œì§ì´ ì¸í”„ë¼ì— ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.

### UserRepository

**ì±…ì„**: ì—¬í–‰ì ì—”í‹°í‹°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- ID, ì´ë©”ì¼, ë‹‰ë„¤ì„ìœ¼ë¡œ ì—¬í–‰ì ì¡°íšŒ
- ì—¬í–‰ì ì •ë³´ ì €ì¥ ë° ì‚­ì œ
- ì´ë©”ì¼/ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬

### CityRepository

**ì±…ì„**: ë„ì‹œ ì—”í‹°í‹°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ë„ì‹œ ì¡°íšŒ
- í™œì„± ë„ì‹œ ëª©ë¡ ì¡°íšŒ

### TicketRepository

**ì±…ì„**: í‹°ì¼“ ì—”í‹°í‹°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- ID, ì‚¬ìš©ì IDë¡œ í‹°ì¼“ ì¡°íšŒ
- ìƒíƒœë³„ í‹°ì¼“ ì¡°íšŒ (PURCHASED/BOARDING/COMPLETED/CANCELED)
- ë¹„í–‰ì„ ë³„ í‹°ì¼“ ì¡°íšŒ
- í‹°ì¼“ ë°œê¶Œ ë° ìƒíƒœ ì—…ë°ì´íŠ¸
- í‹°ì¼“ ë²ˆí˜¸ ìƒì„± (í˜•ì‹: "B0-{ë…„ë„}-{ì¼ë ¨ë²ˆí˜¸}")

### AirshipRepository

**ì±…ì„**: ë¹„í–‰ì„  ì—”í‹°í‹°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ë¹„í–‰ì„  ì¡°íšŒ
- í™œì„± ë¹„í–‰ì„  ëª©ë¡ ì¡°íšŒ
- ë¹„í–‰ì„  ì •ë³´ ê´€ë¦¬

### GuesthouseRepository

**ì±…ì„**: ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ì—”í‹°í‹°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ì¡°íšŒ
- ë„ì‹œë³„ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ëª©ë¡ ì¡°íšŒ
- ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ì •ë³´ ê´€ë¦¬

### RoomRepository

**ì±…ì„**: ë£¸ ì—”í‹°í‹°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ë£¸ ì¡°íšŒ
- ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ë³„ ë£¸ ëª©ë¡ ì¡°íšŒ
- ê°€ìš© ë£¸ ì¡°íšŒ (6ëª… ë¯¸ë§Œ)
- ë£¸ ì •ë³´ ë° ì •ì› ì—…ë°ì´íŠ¸

### RoomStayRepository

**ì±…ì„**: ì²´ë¥˜ ê¸°ë¡ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- ID, ì‚¬ìš©ì ID, ë£¸ IDë¡œ ì²´ë¥˜ ì¡°íšŒ
- í™œì„± ì²´ë¥˜ ëª©ë¡ ì¡°íšŒ
- ì²´í¬ì•„ì›ƒ ì˜ˆì • ì²´ë¥˜ ì¡°íšŒ
- ì²´ë¥˜ ì •ë³´ ì €ì¥ ë° ì—…ë°ì´íŠ¸

### ChatMessageRepository

**ì±…ì„**: ë‹¨ì²´ ëŒ€í™” ë©”ì‹œì§€ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ë©”ì‹œì§€ ì¡°íšŒ
- ë£¸ë³„ ìµœê·¼ ë©”ì‹œì§€ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
- ë§Œë£Œëœ ë©”ì‹œì§€ ì¡°íšŒ ë° ì‚­ì œ
- ë©”ì‹œì§€ ì €ì¥

### ConversationCardRepository

**ì±…ì„**: ëŒ€í™” ì¹´ë“œì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ì¹´ë“œ ì¡°íšŒ
- ë„ì‹œë³„ ì¹´ë“œ ì¡°íšŒ
- í™œì„± ì¹´ë“œ ì¡°íšŒ
- ì¹´ë“œ ì •ë³´ ê´€ë¦¬

### DirectMessageRoomRepository

**ì±…ì„**: 1:1 ëŒ€í™”ë°©ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ëŒ€í™”ë°© ì¡°íšŒ
- ë£¸ë³„, ì‚¬ìš©ìë³„ ëŒ€í™”ë°© ì¡°íšŒ
- ëŒ€í™”ë°© ìƒì„± ë° ìƒíƒœ ì—…ë°ì´íŠ¸
- ì²´í¬ì•„ì›ƒ ì‹œ ëŒ€í™”ë°© ì‚­ì œ

### DirectMessageRepository

**ì±…ì„**: 1:1 ë©”ì‹œì§€ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ë©”ì‹œì§€ ì¡°íšŒ
- ëŒ€í™”ë°©ë³„ ë©”ì‹œì§€ ì¡°íšŒ
- ë©”ì‹œì§€ ì €ì¥ ë° ì½ìŒ ì²˜ë¦¬

### DiaryRepository

**ì±…ì„**: ì¼ê¸°ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ì¼ê¸° ì¡°íšŒ
- ì‚¬ìš©ìë³„ ì¼ê¸° ì¡°íšŒ
- íŠ¹ì • ë‚ ì§œ ì¼ê¸° ì¡°íšŒ (ì¤‘ë³µ ë°©ì§€)
- ì¼ê¸° ì €ì¥

### QuestionnaireRepository

**ì±…ì„**: ë¬¸ë‹µì§€ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ë¬¸ë‹µì§€ ì¡°íšŒ
- ì‚¬ìš©ìë³„ ë¬¸ë‹µì§€ ì¡°íšŒ
- ë„ì‹œë³„ ë¬¸ë‹µì§€ ì¡°íšŒ (ì¤‘ë³µ ë°©ì§€)
- ë¬¸ë‹µì§€ ì €ì¥

### PointTransactionRepository

**ì±…ì„**: í¬ì¸íŠ¸ ê±°ë˜ ê¸°ë¡ì˜ ì˜ì†ì„± ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**:
- IDë¡œ ê±°ë˜ ì¡°íšŒ
- ì‚¬ìš©ìë³„ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
- ê±°ë˜ ìœ í˜•ë³„ ì¡°íšŒ (íšë“/ì‚¬ìš©)
- ê±°ë˜ ê¸°ë¡ ì €ì¥

---

## ë„ë©”ì¸ ê·œì¹™ ìš”ì•½

### ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë° ë£¸ ê·œì¹™

1. **GuesthouseëŠ” ì˜êµ¬ì **: ë„ì‹œë³„ë¡œ í•­ìƒ ì¡´ì¬í•˜ëŠ” ì»¨í…Œì´ë„ˆ
2. **Roomì€ ë™ì **: ì—¬í–‰ì ì²´ë¥˜ ìƒí™©ì— ë”°ë¼ ìƒì„±/soft delete
3. **ë£¸ ìƒì„±**: ì²« ë²ˆì§¸ ì—¬í–‰ì ì²´í¬ì¸ ì‹œ ìë™ ìƒì„±
4. **ë£¸ ë°°ì •**: 6ëª… ë¯¸ë§Œì¸ í™œì„± ë£¸ì— ìë™ ë°°ì •, ì—†ìœ¼ë©´ ìƒˆ ë£¸ ìƒì„±
5. **ë£¸ ì‚­ì œ**: ë§ˆì§€ë§‰ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ `deleted_at` ì„¤ì • (soft delete), ë°°ì¹˜ë¡œ ì‹¤ì œ ì‚­ì œ
6. ë™ì‹œ ì…ì¥ ì‹œ Race Condition ë°©ì§€ (íŠ¸ëœì­ì…˜ ì²˜ë¦¬)

### ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ/ì—°ì¥ ê·œì¹™

#### ì²´í¬ì¸
1. **ê°œë³„ ì²´í¬ì¸**: ê° ì—¬í–‰ìì˜ ì²´í¬ì¸ ì‹œê°„ì´ ë‹¤ë¦„
2. **ì´ˆê¸° ì²´í¬ì•„ì›ƒ ì‹œê°„**: check_in_time + 24ì‹œê°„
3. **ë£¸ ë°°ì •**: 6ëª… ë¯¸ë§Œì¸ í™œì„± ë£¸ì— ìë™ ë°°ì •, ì—†ìœ¼ë©´ ìƒˆ ë£¸ ìƒì„±

#### ì—°ì¥
1. **ì—°ì¥ ìš”ì²­**: ì—¬í–‰ìê°€ ì²´í¬ì•„ì›ƒ ì „ ì–¸ì œë“ ì§€ ì—°ì¥ ê°€ëŠ¥
2. **ì—°ì¥ ë¹„ìš©**: 300P/24ì‹œê°„
3. **í¬ì¸íŠ¸ ê²€ì¦**: í¬ì¸íŠ¸ ë¶€ì¡± ì‹œ ì—°ì¥ ë¶ˆê°€
4. **ì—°ì¥ ì²˜ë¦¬**:
   - scheduled_checkout_timeì— 24ì‹œê°„ ì¶”ê°€
   - extension_count ì¦ê°€
   - total_extension_costì— 300P ëˆ„ì 
   - í¬ì¸íŠ¸ ì°¨ê° (PointTransaction)
5. **ì—°ì¥ ì œí•œ**: ë¬´ì œí•œ (í¬ì¸íŠ¸ë§Œ ìˆìœ¼ë©´)
6. **ì—°ì¥ ê³µì‹**: `ìƒˆ ì²´í¬ì•„ì›ƒ ì‹œê°„ = í˜„ì¬ scheduled_checkout_time + 24ì‹œê°„`

#### ì²´í¬ì•„ì›ƒ
1. **ê°œë³„ ì²´í¬ì•„ì›ƒ**: ê°ì scheduled_checkout_timeì— ìë™ ì²´í¬ì•„ì›ƒ
2. **1ì‹œê°„ ì „ ì•Œë¦¼**: ê° ì—¬í–‰ìì—ê²Œ ê°œë³„ ì•Œë¦¼ ë°œì†¡
3. **ì²´í¬ì•„ì›ƒ ì²˜ë¦¬**:
   - RoomStay ìƒíƒœë¥¼ CHECKED_OUTìœ¼ë¡œ ë³€ê²½
   - actual_checkout_time ê¸°ë¡
   - 1:1 ëŒ€í™”ë°© ìë™ ì‚­ì œ
   - Roomì˜ current_capacity ê°ì†Œ
4. **ë£¸ ì‚­ì œ**: ë§ˆì§€ë§‰ ì—¬í–‰ì ì²´í¬ì•„ì›ƒ ì‹œ (current_capacity = 0) ë£¸ì˜ `deleted_at` ì„¤ì • (soft delete)

### í¬ì¸íŠ¸ ê·œì¹™

**íšë“**:
- íšŒì›ê°€ì…: 1000P (ìµœì´ˆ 1íšŒ)
- ì¼ê¸° ì‘ì„±: 50P (í•˜ë£¨ 1íšŒ)
- ë¬¸ë‹µì§€ ì‘ì„±: 50P (ë„ì‹œë³„ 1íšŒ)

**ì‚¬ìš©**:
- ë¹„í–‰ì„  í‹°ì¼“: City.base_cost_points Ã— Airship.cost_factor
  - ì˜ˆ: ì„¸ë Œì‹œì•„(100P) + ì¼ë°˜ ë¹„í–‰ì„ (Ã—1) = 100P
  - ì˜ˆ: ì„¸ë Œì‹œì•„(100P) + ê³ ì† ë¹„í–‰ì„ (Ã—2) = 200P
- ì²´ë¥˜ ì—°ì¥: 300P/24ì‹œê°„ (ë¬´ì œí•œ íšŸìˆ˜)

**ì œì•½**:
- í¬ì¸íŠ¸ëŠ” ìŒìˆ˜ ë¶ˆê°€
- í¬ì¸íŠ¸ ë¶€ì¡± ì‹œ ê²°ì œ/ì—°ì¥ ë¶ˆê°€
- ëª¨ë“  ê±°ë˜ëŠ” PointTransactionìœ¼ë¡œ ê¸°ë¡
- íŠ¸ëœì­ì…˜ ê²©ë¦¬ë¡œ ë™ì‹œì„± ì œì–´

### ë©”ì‹œì§€ ê·œì¹™

1. ì±„íŒ… ë©”ì‹œì§€ëŠ” ìµœëŒ€ 300ì
2. ì±„íŒ… ë©”ì‹œì§€ëŠ” 3ì¼ í›„ ìë™ ì‚­ì œ
3. 1:1 ëŒ€í™”ëŠ” ê°™ì€ ë£¸ ë‚´ì—ì„œë§Œ ê°€ëŠ¥
4. 1:1 ëŒ€í™”ëŠ” ì²´í¬ì•„ì›ƒ ì‹œ ì‚­ì œ

### ì¼ê¸°/ë¬¸ë‹µì§€ ê·œì¹™

1. ì¼ê¸°ëŠ” í•˜ë£¨ 1ê°œ (user_id, diary_date ìœ ì¼)
2. ë¬¸ë‹µì§€ëŠ” ë„ì‹œë³„ 1ê°œ (user_id, city_id ìœ ì¼)
3. ì¼ê¸°ëŠ” 500ì, ë¬¸ë‹µì§€ ë‹µë³€ì€ 200ì
4. ì¼ê¸°/ë¬¸ë‹µì§€ ì¡°íšŒëŠ” ë³¸ì¸ë§Œ ê°€ëŠ¥ (read-only)
5. ì¼ê¸°/ë¬¸ë‹µì§€ ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€ (ì‘ì„±ë§Œ ê°€ëŠ¥)

---

## API ì—”ë“œí¬ì¸íŠ¸ (ReflectionContext)

### Diary (ì¼ê¸°) API

#### POST /api/v1/diaries
**ì„¤ëª…**: ì¼ê¸° ì‘ì„±
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ìš”ì²­**:
```json
{
  "title": "ì˜¤ëŠ˜ì˜ ì¼ê¸°",  // Optional, max 100ì
  "content": "ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?",  // Required, max 500ì
  "mood": "ğŸ˜Š",  // Required, 5ê°œ ì¤‘ ì„ íƒ (ğŸ˜Š ğŸ˜ ğŸ˜¢ ğŸ˜  ğŸ¥°)
  "diary_date": "2024-12-15",  // Required, ISO 8601 date
  "city_id": "uuid"  // Optional
}
```
**ì‘ë‹µ**: 201 Created
```json
{
  "data": {
    "diary_id": "uuid",
    "user_id": "uuid",
    "title": "ì˜¤ëŠ˜ì˜ ì¼ê¸°",
    "content": "ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?",
    "mood": "ğŸ˜Š",
    "diary_date": "2024-12-15",
    "city_id": "uuid",
    "has_earned_points": true,
    "created_at": "2024-12-15T10:00:00Z",
    "updated_at": "2024-12-15T10:00:00Z"
  }
}
```
**ì—ëŸ¬**:
- 400: ì˜ëª»ëœ mood ì´ëª¨ì§€
- 409: ê°™ì€ ë‚ ì§œ ì¤‘ë³µ ì¼ê¸° ì‘ì„±
- 422: ë‚´ìš© ê¸¸ì´ ì´ˆê³¼ (500ì)

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
- í•˜ë£¨ 1íšŒ ì‘ì„± ì‹œ 50P ì§€ê¸‰
- (user_id, diary_date) ìœ ì¼ì„± ê²€ì¦
- í¬ì¸íŠ¸ëŠ” ìµœì´ˆ 1íšŒë§Œ ì§€ê¸‰ (has_earned_points í”Œë˜ê·¸)

#### GET /api/v1/diaries/today
**ì„¤ëª…**: ì˜¤ëŠ˜ ì¼ê¸° ì¡°íšŒ
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ì‘ë‹µ**: 200 OK
```json
{
  "data": {
    "diary_id": "uuid",
    "user_id": "uuid",
    "title": "ì˜¤ëŠ˜ì˜ ì¼ê¸°",
    "content": "ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?",
    "mood": "ğŸ˜Š",
    "diary_date": "2024-12-15",
    "city_id": "uuid",
    "has_earned_points": true,
    "created_at": "2024-12-15T10:00:00Z",
    "updated_at": "2024-12-15T10:00:00Z"
  }
}
```
**ì—ëŸ¬**:
- 404: ì˜¤ëŠ˜ ì¼ê¸° ì—†ìŒ

#### GET /api/v1/diaries
**ì„¤ëª…**: ë‚´ ì¼ê¸° ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**:
- `offset`: í˜ì´ì§€ ì˜¤í”„ì…‹ (default: 0)
- `limit`: í˜ì´ì§€ í¬ê¸° (default: 20, max: 100)

**ì‘ë‹µ**: 200 OK
```json
{
  "data": {
    "diaries": [
      {
        "diary_id": "uuid",
        "user_id": "uuid",
        "title": "ì„¸ë Œì‹œì•„ì—ì„œì˜ ì²«ë‚ ",
        "content": "ì˜¤ëŠ˜ ì²˜ìŒìœ¼ë¡œ ì„¸ë Œì‹œì•„ì— ë„ì°©í–ˆë‹¤...",
        "mood": "ğŸ¥°",
        "diary_date": "2024-12-15",
        "city_id": "uuid",
        "has_earned_points": true,
        "created_at": "2024-12-15T10:00:00Z",
        "updated_at": "2024-12-15T10:00:00Z"
      }
    ],
    "total": 10,
    "offset": 0,
    "limit": 20
  }
}
```
**ì •ë ¬**: diary_date DESC (ìµœì‹ ìˆœ)
**ì ‘ê·¼ ì œì–´**: ë³¸ì¸ ì¼ê¸°ë§Œ ì¡°íšŒ ê°€ëŠ¥

#### GET /api/v1/diaries/:diaryId
**ì„¤ëª…**: ì¼ê¸° ìƒì„¸ ì¡°íšŒ
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ì‘ë‹µ**: 200 OK
```json
{
  "data": {
    "diary_id": "uuid",
    "user_id": "uuid",
    "title": "ì„¸ë Œì‹œì•„ì—ì„œì˜ ì²«ë‚ ",
    "content": "ì˜¤ëŠ˜ ì²˜ìŒìœ¼ë¡œ ì„¸ë Œì‹œì•„ì— ë„ì°©í–ˆë‹¤. ë…¸ì„ë¹› í•­êµ¬ì˜ í’ê²½ì´ ì •ë§ ì•„ë¦„ë‹¤ì› ë‹¤...",
    "mood": "ğŸ¥°",
    "diary_date": "2024-12-15",
    "city_id": "uuid",
    "has_earned_points": true,
    "created_at": "2024-12-15T10:00:00Z",
    "updated_at": "2024-12-15T10:00:00Z"
  }
}
```
**ì—ëŸ¬**:
- 404: ì¼ê¸° ì—†ìŒ
- 403: ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì¼ê¸° ì ‘ê·¼ ì‹œë„

**ì ‘ê·¼ ì œì–´**: ë³¸ì¸ ì¼ê¸°ë§Œ ì¡°íšŒ ê°€ëŠ¥

---

### Questionnaire (ë¬¸ë‹µì§€) API

#### POST /api/v1/questionnaires
**ì„¤ëª…**: ë¬¸ë‹µì§€ ì‘ì„±
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ìš”ì²­**:
```json
{
  "city_id": "uuid",  // Required
  "question_1_answer": "ì¹œêµ¬ ë¯¼ì§€ì…ë‹ˆë‹¤...",  // Required, max 200ì
  "question_2_answer": "ì˜¤ëŠ˜ ì‚¬ë‘ë°©ì—ì„œ...",  // Required, max 200ì
  "question_3_answer": "ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³ ...",  // Required, max 200ì
}
```
**ì‘ë‹µ**: 201 Created
```json
{
  "data": {
    "questionnaire_id": "uuid",
    "user_id": "uuid",
    "city_id": "uuid",
    "question_1": "ìš”ì¦˜ ë‚˜ì—ê²Œ í˜ì´ ë˜ì–´ì£¼ëŠ” ì‚¬ëŒì€?",
    "question_1_answer": "ì¹œêµ¬ ë¯¼ì§€ì…ë‹ˆë‹¤...",
    "question_2": "ìµœê·¼ì— ëˆ„êµ°ê°€ì™€ ë‚˜ëˆˆ ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ëŠ”?",
    "question_2_answer": "ì˜¤ëŠ˜ ì‚¬ë‘ë°©ì—ì„œ...",
    "question_3": "ê´€ê³„ì—ì„œ ë‚´ê°€ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€?",
    "question_3_answer": "ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³ ...",
    "has_earned_points": true,
    "created_at": "2024-12-15T10:00:00Z",
    "updated_at": "2024-12-15T10:00:00Z"
  }
}
```
**ì—ëŸ¬**:
- 400: ì˜ëª»ëœ city_id
- 409: ê°™ì€ ë„ì‹œ ì¤‘ë³µ ë¬¸ë‹µì§€ ì‘ì„±
- 422: ë‹µë³€ ê¸¸ì´ ì´ˆê³¼ (200ì)

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
- ë„ì‹œë³„ 1íšŒ ì‘ì„± ì‹œ 50P ì§€ê¸‰
- (user_id, city_id) ìœ ì¼ì„± ê²€ì¦
- í¬ì¸íŠ¸ëŠ” ìµœì´ˆ 1íšŒë§Œ ì§€ê¸‰ (has_earned_points í”Œë˜ê·¸)
- ì§ˆë¬¸ì€ ë„ì‹œë³„ë¡œ ë‹¤ë¦„ (CityQuestion ì—”í‹°í‹° ì°¸ì¡°)

#### GET /api/v1/questionnaires
**ì„¤ëª…**: ë‚´ ë¬¸ë‹µì§€ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**:
- `offset`: í˜ì´ì§€ ì˜¤í”„ì…‹ (default: 0)
- `limit`: í˜ì´ì§€ í¬ê¸° (default: 20, max: 100)

**ì‘ë‹µ**: 200 OK
```json
{
  "data": {
    "questionnaires": [
      {
        "questionnaire_id": "uuid",
        "user_id": "uuid",
        "city_id": "uuid",
        "city_name": "ì„¸ë Œì‹œì•„",
        "city_theme": "ê´€ê³„ì˜ ë„ì‹œ",
        "question_1": "ìš”ì¦˜ ë‚˜ì—ê²Œ í˜ì´ ë˜ì–´ì£¼ëŠ” ì‚¬ëŒì€?",
        "question_1_answer": "ì¹œêµ¬ ë¯¼ì§€ì…ë‹ˆë‹¤...",
        "question_2": "ìµœê·¼ì— ëˆ„êµ°ê°€ì™€ ë‚˜ëˆˆ ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ëŠ”?",
        "question_2_answer": "ì˜¤ëŠ˜ ì‚¬ë‘ë°©ì—ì„œ...",
        "question_3": "ê´€ê³„ì—ì„œ ë‚´ê°€ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€?",
        "question_3_answer": "ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³ ...",
        "has_earned_points": true,
        "created_at": "2024-12-15T10:00:00Z",
        "updated_at": "2024-12-15T10:00:00Z"
      }
    ],
    "total": 3,
    "offset": 0,
    "limit": 20
  }
}
```
**ì •ë ¬**: created_at DESC (ìµœì‹ ìˆœ)
**ì ‘ê·¼ ì œì–´**: ë³¸ì¸ ë¬¸ë‹µì§€ë§Œ ì¡°íšŒ ê°€ëŠ¥

#### GET /api/v1/questionnaires/:questionnaireId
**ì„¤ëª…**: ë¬¸ë‹µì§€ ìƒì„¸ ì¡°íšŒ
**ì¸ì¦**: í•„ìˆ˜ (JWT)
**ì‘ë‹µ**: 200 OK
```json
{
  "data": {
    "questionnaire_id": "uuid",
    "user_id": "uuid",
    "city_id": "uuid",
    "city_name": "ì„¸ë Œì‹œì•„",
    "city_theme": "ê´€ê³„ì˜ ë„ì‹œ",
    "question_1": "ìš”ì¦˜ ë‚˜ì—ê²Œ í˜ì´ ë˜ì–´ì£¼ëŠ” ì‚¬ëŒì€?",
    "question_1_answer": "ì¹œêµ¬ ë¯¼ì§€ì…ë‹ˆë‹¤. í˜ë“¤ ë•Œ í•­ìƒ ë‚´ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì£¼ê³  ì‘ì›í•´ì¤ë‹ˆë‹¤.",
    "question_2": "ìµœê·¼ì— ëˆ„êµ°ê°€ì™€ ë‚˜ëˆˆ ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ëŠ”?",
    "question_2_answer": "ì˜¤ëŠ˜ ì‚¬ë‘ë°©ì—ì„œ ë¯¼ìˆ˜ë‹˜ê³¼ ë‚˜ëˆˆ ëŒ€í™”ê°€ ê¸°ì–µì— ë‚¨ì•„ìš”...",
    "question_3": "ê´€ê³„ì—ì„œ ë‚´ê°€ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€?",
    "question_3_answer": "ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³  ì§„ì‹¬ìœ¼ë¡œ ëŒ€í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤...",
    "has_earned_points": true,
    "created_at": "2024-12-15T10:00:00Z",
    "updated_at": "2024-12-15T10:00:00Z"
  }
}
```
**ì—ëŸ¬**:
- 404: ë¬¸ë‹µì§€ ì—†ìŒ
- 403: ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë¬¸ë‹µì§€ ì ‘ê·¼ ì‹œë„

**ì ‘ê·¼ ì œì–´**: ë³¸ì¸ ë¬¸ë‹µì§€ë§Œ ì¡°íšŒ ê°€ëŠ¥

---

## ê°œì¸ ìˆ™ì†Œ (Personal Room) í™”ë©´ íë¦„

### ì ‘ê·¼ ê²½ë¡œ
1. **ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ì—ì„œ**: `/guesthouse/:cityId/room` - ê°œì¸ ìˆ™ì†Œ ë©”ì¸
2. **í”„ë¡œí•„ ëª¨ë‹¬ì—ì„œ**:
   - "ë‚˜ì˜ ì¼ê¸°" â†’ `/diary` (ì¼ê¸° ë¦¬ìŠ¤íŠ¸)
   - "ë‚˜ì˜ ë¬¸ë‹µì§€" â†’ `/questionnaire` (ë¬¸ë‹µì§€ ë¦¬ìŠ¤íŠ¸)

### í™”ë©´ êµ¬ì¡°

#### 3.13 ê°œì¸ ìˆ™ì†Œ (`/guesthouse/:cityId/room`)
- **ì¼ê¸° ì“°ê¸° ì¹´ë“œ**:
  - ìƒíƒœ: "ì˜¤ëŠ˜ ì‘ì„± ê°€ëŠ¥ â—‹" / "ì˜¤ëŠ˜ ì‘ì„± ì™„ë£Œ âœ“"
  - ì™„ë£Œ ì‹œ í´ë¦­ â†’ `/diary/:diaryId` (ì˜¤ëŠ˜ ì¼ê¸° ìƒì„¸)
  - ë¯¸ì™„ë£Œ ì‹œ í´ë¦­ â†’ `/guesthouse/:cityId/room/diary` (ì¼ê¸° ì‘ì„±)
- **ë¬¸ë‹µì§€ ì¹´ë“œ**:
  - ìƒíƒœ: "ë¯¸ì™„ë£Œ â—‹" / "ì™„ë£Œ âœ“"
  - ì™„ë£Œ ì‹œ í´ë¦­ â†’ `/questionnaire/:questionnaireId` (ë¬¸ë‹µì§€ ìƒì„¸)
  - ë¯¸ì™„ë£Œ ì‹œ í´ë¦­ â†’ `/guesthouse/:cityId/room/questionnaire` (ë¬¸ë‹µì§€ ì‘ì„±)

#### 3.14 ì¼ê¸° ì‘ì„± (`/guesthouse/:cityId/room/diary`)
- ì œëª© (ì„ íƒ, max 100ì)
- ì˜¤ëŠ˜ì˜ ê¸°ë¡ (í•„ìˆ˜, max 500ì)
- ì˜¤ëŠ˜ì˜ ê¸°ë¶„ (í•„ìˆ˜, 5ê°œ ì´ëª¨ì§€ ì¤‘ ì„ íƒ)
- ì €ì¥ ë²„íŠ¼ â†’ POST /api/v1/diaries

#### 3.15 ë¬¸ë‹µì§€ ì‘ì„± (`/guesthouse/:cityId/room/questionnaire`)
- 3ê°œ ì§ˆë¬¸ (ë„ì‹œë³„ë¡œ ë‹¤ë¦„)
- ê° ë‹µë³€ (max 200ì)
- í˜ì´ì§€ë„¤ì´ì…˜: ì´ì „/ë‹¤ìŒ ë²„íŠ¼ (1/3, 2/3, 3/3)
- ì™„ë£Œ ë²„íŠ¼ â†’ POST /api/v1/questionnaires

#### 3.16 ì¼ê¸° ë¦¬ìŠ¤íŠ¸ (`/diary`)
- í”„ë¡œí•„ ëª¨ë‹¬ â†’ "ë‚˜ì˜ ì¼ê¸°" ë©”ë‰´ì—ì„œ ì ‘ê·¼
- ì¼ê¸° ì¹´ë“œ: ë‚ ì§œ, ì œëª©, ë¯¸ë¦¬ë³´ê¸° (2ì¤„), ë„ì‹œ, ê¸°ë¶„ ì´ëª¨ì§€
- ì •ë ¬: ìµœì‹ ìˆœ (diary_date DESC)
- í´ë¦­ â†’ `/diary/:diaryId`
- ë¹ˆ ìƒíƒœ: "ì•„ì§ ì‘ì„±í•œ ì¼ê¸°ê°€ ì—†ì–´ìš”"

#### 3.17 ì¼ê¸° ìƒì„¸ (`/diary/:diaryId`)
- ë‚ ì§œ, ì œëª©, ë„ì‹œ, ì „ì²´ ë‚´ìš©, ê¸°ë¶„ ì´ëª¨ì§€
- Read-only (ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€)
- ë³¸ì¸ë§Œ ì¡°íšŒ ê°€ëŠ¥

#### 3.18 ë¬¸ë‹µì§€ ë¦¬ìŠ¤íŠ¸ (`/questionnaire`)
- í”„ë¡œí•„ ëª¨ë‹¬ â†’ "ë‚˜ì˜ ë¬¸ë‹µì§€" ë©”ë‰´ì—ì„œ ì ‘ê·¼
- ë¬¸ë‹µì§€ ì¹´ë“œ: ë„ì‹œ ì•„ì´ì½˜+ì´ë¦„, ë‚ ì§œ, ì²« ì§ˆë¬¸, ë‹µë³€ ë¯¸ë¦¬ë³´ê¸°
- ì •ë ¬: ìµœì‹ ìˆœ (created_at DESC)
- í´ë¦­ â†’ `/questionnaire/:questionnaireId`
- ë¹ˆ ìƒíƒœ: "ì•„ì§ ì‘ì„±í•œ ë¬¸ë‹µì§€ê°€ ì—†ì–´ìš”"

#### 3.19 ë¬¸ë‹µì§€ ìƒì„¸ (`/questionnaire/:questionnaireId`)
- ë„ì‹œ ì•„ì´ì½˜+ì´ë¦„+í…Œë§ˆ, ë‚ ì§œ
- 3ê°œ ì§ˆë¬¸ê³¼ ì „ì²´ ë‹µë³€ (ì„¸ë¡œ ìŠ¤í¬ë¡¤)
- Read-only (ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€)
- ë³¸ì¸ë§Œ ì¡°íšŒ ê°€ëŠ¥

#### 3.20 í”„ë¡œí•„ ëª¨ë‹¬
- "ë‚˜ì˜ ì¼ê¸°" ë©”ë‰´ â†’ `/diary`
- "ë‚˜ì˜ ë¬¸ë‹µì§€" ë©”ë‰´ â†’ `/questionnaire`
4. ë³¸ì¸ë§Œ ì¡°íšŒ ê°€ëŠ¥
